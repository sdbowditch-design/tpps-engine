<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TPPS – TrackMan Reco UI (GitHub Pages)</title>
  <style>
    :root{
      --bg0:#070a10; --bg1:#0b101a;
      --panelA: rgba(14,22,36,.92);
      --panelB: rgba(11,18,32,.82);
      --line:#1b2a3f; --line2:#273a55;
      --text:#e9f0fb; --muted:#8da0b7;
      --good:#5eead4; --bad:#fb7185; --flat:#93c5fd;
      --accent:#60a5fa; --accent2:#a78bfa; --amber:#fbbf24;
      --shadow: 0 22px 60px rgba(0,0,0,.48);
      --r:16px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--text);
      background:
        radial-gradient(1100px 700px at 18% 10%, rgba(96,165,250,.18), transparent 60%),
        radial-gradient(900px 600px at 85% 15%, rgba(167,139,250,.14), transparent 55%),
        radial-gradient(900px 700px at 50% 115%, rgba(94,234,212,.10), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
    }
    .shell{max-width:1180px;margin:0 auto;padding:18px 16px 40px}
    .topbar{
      border:1px solid var(--line);
      background: linear-gradient(180deg, var(--panelA), var(--panelB));
      border-radius: var(--r);
      padding:14px;
      box-shadow: var(--shadow);
      display:flex;flex-direction:column;gap:12px;
    }
    .brand{display:flex;align-items:center;gap:12px}
    .mark{
      width:44px;height:44px;border-radius:14px;
      background: linear-gradient(135deg, rgba(96,165,250,.90), rgba(167,139,250,.85));
      box-shadow: 0 14px 35px rgba(96,165,250,.18);
      position:relative;
    }
    .mark:after{
      content:"";
      position:absolute; inset:8px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,.25);
      background: rgba(0,0,0,.12);
    }
    .kicker{color:var(--muted);letter-spacing:.14em;text-transform:uppercase;font-size:11px}
    h1{margin:0;font-size:20px}
    .sub{color:var(--muted);font-size:12px;line-height:1.35}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between}
    .chip{
      display:inline-flex;align-items:center;gap:8px;
      border:1px solid var(--line2);
      padding:7px 10px;border-radius:999px;
      background: rgba(0,0,0,.18);
      font-weight:900;font-size:12px;color:var(--muted);
    }
    .dot{width:9px;height:9px;border-radius:99px;display:inline-block}
    .dot--ok{background:var(--good); box-shadow: 0 0 12px rgba(94,234,212,.45)}
    .dot--warn{background:var(--amber); box-shadow: 0 0 12px rgba(251,191,36,.35)}

    .grid{margin-top:14px;display:grid;grid-template-columns: 1.05fr .95fr;gap:12px}
    .panel{
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(14,22,36,.86), rgba(11,18,32,.76));
      border-radius: var(--r);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .ph{display:flex;align-items:center;justify-content:space-between;padding:12px;border-bottom:1px solid var(--line);background: rgba(0,0,0,.18)}
    .pt{font-size:12px;letter-spacing:.18em;text-transform:uppercase;color:var(--muted);font-weight:900}
    .pb{padding:12px}

    label{display:block;color:var(--muted);font-size:12px;margin:10px 0 6px}
    input, select, textarea{
      width:100%;
      background: rgba(0,0,0,.18);
      border:1px solid var(--line2);
      color: var(--text);
      padding:10px 10px;border-radius:12px;
      outline:none;
      font-weight:800;
    }
    textarea{min-height:70px;resize:vertical;font-weight:700}
    .two{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .btnRow{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .btn{
      border:1px solid rgba(96,165,250,.45);
      background: linear-gradient(180deg, rgba(96,165,250,.28), rgba(0,0,0,.22));
      color: var(--text);
      padding:10px 12px;border-radius:12px;
      font-weight:950; cursor:pointer; font-size:12px;
    }
    .btn--ghost{background: rgba(0,0,0,.18);border-color: var(--line2);color: var(--muted)}
    .hint{color:var(--muted);font-size:12px;line-height:1.35;margin-top:10px}
    .mono{font-family:var(--mono)}
    .rank{display:flex;flex-direction:column;gap:10px}
    .card{border:1px solid var(--line);background: rgba(7,10,16,.28);border-radius:14px;padding:12px}
    .top{display:flex;justify-content:space-between;gap:10px;align-items:flex-start}
    .name{font-weight:950}
    .score{font-weight:950;color:var(--good)}
    .why{margin-top:8px;color:var(--muted);font-size:12px;line-height:1.4}
    .meta{margin-top:8px;color:var(--muted);font-size:12px}
    @media (max-width: 980px){ .grid{grid-template-columns:1fr} .two{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <div class="shell">
    <header class="topbar">
      <div class="brand">
        <div class="mark"></div>
        <div style="flex:1">
          <div class="kicker">TPPS – TrackMan Recommendation Engine</div>
          <div class="row">
            <h1>GitHub Pages UI – Manual Input</h1>
            <span class="chip"><span id="dot" class="dot dot--warn"></span><span id="status">Loading shafts.json…</span></span>
          </div>
          <div class="sub">Enter what you know → engine ranks shafts + explains why. Static site (no VPS).</div>
        </div>
      </div>
    </header>

    <main class="grid">
      <section class="panel">
        <div class="ph"><div class="pt">Manual Inputs</div></div>
        <div class="pb">
          <div class="two">
            <div>
              <label>Club Speed (mph)</label>
              <input id="clubSpeed" type="number" step="0.1" placeholder="e.g. 108" />
            </div>
            <div>
              <label>Ball Speed (mph) (optional)</label>
              <input id="ballSpeed" type="number" step="0.1" placeholder="e.g. 160" />
            </div>
          </div>

          <div class="two">
            <div>
              <label>Launch Angle (°) (optional)</label>
              <input id="launch" type="number" step="0.1" placeholder="e.g. 12.5" />
            </div>
            <div>
              <label>Spin (rpm) (optional)</label>
              <input id="spin" type="number" step="10" placeholder="e.g. 2400" />
            </div>
          </div>

          <div class="two">
            <div>
              <label>Typical Miss</label>
              <select id="miss">
                <option value="unknown">Unknown</option>
                <option value="left">Left</option>
                <option value="right">Right</option>
                <option value="both">Both</option>
              </select>
            </div>
            <div>
              <label>Tempo / Transition</label>
              <select id="tempo">
                <option value="unknown">Unknown</option>
                <option value="smooth">Smooth</option>
                <option value="moderate">Moderate</option>
                <option value="aggressive">Aggressive</option>
              </select>
            </div>
          </div>

          <label>Notes (optional)</label>
          <textarea id="notes" placeholder="e.g. wants lower spin, fights left, misses toe…"></textarea>

          <div class="btnRow">
            <button class="btn" id="run">Get Recommendations</button>
            <button class="btn btn--ghost" id="demo">Load Demo</button>
            <button class="btn btn--ghost" id="clear">Clear</button>
          </div>

          <div class="hint">Targets (v1 defaults): Launch ~12–15°, Spin ~2000–2600 rpm.</div>
        </div>
      </section>

      <section class="panel">
        <div class="ph"><div class="pt">Recommendations</div></div>
        <div class="pb">
          <div class="rank" id="ranking">
            <div class="hint">Enter inputs and click “Get Recommendations”.</div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    let SHAFTS = [];
    const el = (id) => document.getElementById(id);
    const num = (id) => {
      const v = el(id).value;
      if (v === "" || v === null || v === undefined) return null;
      const n = Number(v);
      return Number.isFinite(n) ? n : null;
    };
    const clamp = (x,a,b) => Math.min(b, Math.max(a,x));

    function setStatus(ok, text){
      el("status").textContent = text;
      el("dot").className = "dot " + (ok ? "dot--ok" : "dot--warn");
    }

    function confidence(inputs){
      let s = 0;
      if (inputs.clubSpeed !== null) s += 0.45;
      if (inputs.launch !== null) s += 0.20;
      if (inputs.spin !== null) s += 0.20;
      if (inputs.tempo !== "unknown") s += 0.10;
      if (inputs.miss !== "unknown") s += 0.05;
      return Math.round(s * 100);
    }

    function bucketLaunch(launch){
      if (launch === null) return "unknown";
      if (launch < 11.5) return "low";
      if (launch > 15.5) return "high";
      return "mid";
    }
    function bucketSpin(spin){
      if (spin === null) return "unknown";
      if (spin < 2000) return "low";
      if (spin > 2800) return "high";
      if (spin > 2400) return "mid_high";
      return "mid";
    }

    function scoreShaft(shaft, inputs){
      let score = 0;
      const why = [];

      if (inputs.clubSpeed !== null){
        if (inputs.clubSpeed >= shaft.speedMin && inputs.clubSpeed <= shaft.speedMax){
          score += 45; why.push("Speed band fit");
        } else {
          const dist = inputs.clubSpeed < shaft.speedMin ? (shaft.speedMin - inputs.clubSpeed) : (inputs.clubSpeed - shaft.speedMax);
          const penalty = clamp(dist * 4, 10, 35);
          score += (45 - penalty);
          why.push("Speed band near-fit");
        }
      } else { score += 20; why.push("Speed unknown"); }

      if (inputs.tempo !== "unknown"){
        if (inputs.tempo === shaft.tempoFit){ score += 12; why.push("Tempo match"); }
        else if (inputs.tempo === "moderate"){ score += 7; why.push("Tempo acceptable"); }
        else { score += 3; why.push("Tempo mismatch risk"); }
      } else { score += 6; why.push("Tempo unknown"); }

      const l = bucketLaunch(inputs.launch);
      if (l !== "unknown"){
        if (l === "low"){
          score += (["mid","mid_high","high"].includes(shaft.launch) ? 18 : 8);
          why.push((["mid","mid_high","high"].includes(shaft.launch) ? "Launch assist" : "Launch neutral"));
        } else if (l === "high"){
          score += (["low","mid_low"].includes(shaft.launch) ? 18 : 8);
          why.push((["low","mid_low"].includes(shaft.launch) ? "Launch control" : "Launch neutral"));
        } else {
          score += (["mid","mid_low","mid_high"].includes(shaft.launch) ? 14 : 9);
          why.push((["mid","mid_low","mid_high"].includes(shaft.launch) ? "Launch in-window" : "Launch slight shift"));
        }
      } else { score += 8; why.push("Launch unknown"); }

      const sp = bucketSpin(inputs.spin);
      if (sp !== "unknown"){
        if (sp === "high"){
          score += (["low","mid"].includes(shaft.spin) ? 18 : 8);
          why.push((["low","mid"].includes(shaft.spin) ? "Spin reduction" : "Spin neutral"));
        } else if (sp === "low"){
          score += (["mid","mid_high","high"].includes(shaft.spin) ? 14 : 9);
          why.push((["mid","mid_high","high"].includes(shaft.spin) ? "Spin support" : "Spin neutral"));
        } else {
          score += (["mid","low","mid_high"].includes(shaft.spin) ? 14 : 9);
          why.push((["mid","low","mid_high"].includes(shaft.spin) ? "Spin in-window" : "Spin slight shift"));
        }
      } else { score += 8; why.push("Spin unknown"); }

      if (inputs.miss !== "unknown"){
        if (inputs.miss === "left"){
          score += (shaft.torque <= 3.3 || ["tip_stiff","very_tip_stiff"].includes(shaft.profile) ? 7 : 4);
          why.push((shaft.torque <= 3.3 || ["tip_stiff","very_tip_stiff"].includes(shaft.profile)) ? "Stability bias (proxy)" : "Neutral stability");
        } else if (inputs.miss === "right"){
          score += (shaft.torque >= 3.6 || ["mid_soft","soft_tip"].includes(shaft.profile) ? 7 : 4);
          why.push((shaft.torque >= 3.6 || ["mid_soft","soft_tip"].includes(shaft.profile)) ? "Closure help (proxy)" : "Neutral closure");
        } else {
          score += (shaft.torque <= 3.5 ? 6 : 4);
          why.push((shaft.torque <= 3.5) ? "Dispersion stability (proxy)" : "Dispersion neutral");
        }
      } else { score += 4; why.push("Miss unknown"); }

      return { score: Math.round(score), why };
    }

    function getInputs(){
      return {
        clubSpeed: num("clubSpeed"),
        ballSpeed: num("ballSpeed"),
        launch: num("launch"),
        spin: num("spin"),
        miss: el("miss").value,
        tempo: el("tempo").value,
        notes: el("notes").value || ""
      };function render(scored, conf){
  const box = el("ranking");
  box.innerHTML = "";

  // ✅ ADD THIS BLOCK
  const inputs = getInputs();
  const tier = speedTier(inputs.clubSpeed);
  const window = targetWindow(inputs.clubSpeed);

  const profileBox = document.createElement("div");
  profileBox.className = "card";
  profileBox.innerHTML = `
    <div class="top">
      <div class="name">Player Profile</div>
      <div class="score">${tier.toUpperCase()}</div>
    </div>
    <div class="why">
      Target Launch: ${window.launchMin}° – ${window.launchMax}° |
      Target Spin: ${window.spinMin} – ${window.spinMax} rpm
    </div>
  `;
  box.appendChild(profileBox);

  // ✅ ADD THIS BLOCK (head trait suggestion)
  let headAdvice = "";
  if(inputs.spin !== null){
    if(inputs.spin > window.spinMax) headAdvice = "Lower-spin head / forward CG / consider lower loft sleeve.";
    else if(inputs.spin < window.spinMin) headAdvice = "Higher-spin head / rear CG / consider more loft.";
    else headAdvice = "Spin window acceptable — choose head by dispersion/feel.";
  } else {
    headAdvice = "Spin unknown — head recommendation limited (enter spin for better result).";
  }

  const headBox = document.createElement("div");
  headBox.className = "card";
  headBox.innerHTML = `
    <div class="top">
      <div class="name">Head Recommendation</div>
      <div class="score">TRAIT</div>
    </div>
    <div class="why">${headAdvice}</div>
  `;
  box.appendChild(headBox);

  // existing shaft cards
  scored.slice(0,3).forEach((r, i) => {
    ...
  });
}
    }

    function render(scored, conf){
      const box = el("ranking");
      box.innerHTML = "";
      scored.slice(0,3).forEach((r, i) => {
        const c = document.createElement("div");
        c.className = "card";
        c.innerHTML = `
          <div class="top">
            <div class="name">#${i+1} — ${r.shaft.name}</div>
            <div class="score">${r.score}</div>
          </div>
          <div class="why"><b>Confidence:</b> ${conf}% • ${r.why.join(" • ")}</div>
          <div class="meta">${r.shaft.weight}g • ${r.shaft.flex} • torque ${r.shaft.torque} • launch ${r.shaft.launch} • spin ${r.shaft.spin}</div>
        `;
        box.appendChild(c);
      });
    }

    function run(){
      const inputs = getInputs();
      const conf = confidence(inputs);
      const scored = SHAFTS.map(s => {
        const res = scoreShaft(s, inputs);
        return { shaft: s, score: res.score, why: res.why };
      }).sort((a,b)=>b.score-a.score);
      render(scored, conf);
    }

    function demo(){
      el("clubSpeed").value = 108;
      el("ballSpeed").value = 160;
      el("launch").value = 11.8;
      el("spin").value = 2900;
      el("miss").value = "left";
      el("tempo").value = "aggressive";
      el("notes").value = "Wants tighter left miss and lower spin.";
      run();
    }

    function clearAll(){
      ["clubSpeed","ballSpeed","launch","spin","notes"].forEach(id => el(id).value = "");
      el("miss").value = "unknown";
      el("tempo").value = "unknown";
      el("ranking").innerHTML = `<div class="hint">Enter inputs and click “Get Recommendations”.</div>`;
    }

    el("run").addEventListener("click", run);
    el("demo").addEventListener("click", demo);
    el("clear").addEventListener("click", clearAll);

    async function init(){
      try{
        const res = await fetch("./shafts.json", { cache:"no-store" });
        if(!res.ok) throw new Error("HTTP " + res.status);
        SHAFTS = await res.json();
        setStatus(true, `Loaded shafts.json (${SHAFTS.length})`);
      } catch(e){
        setStatus(false, "shafts.json failed to load");
        console.error(e);
      }
    }
    init();
    function speedTier(speed){
  if (speed === null) return "unknown";
  if (speed < 90) return "slow";
  if (speed < 102) return "moderate";
  if (speed < 112) return "fast";
  return "elite";
}

function targetWindow(speed){
  const tier = speedTier(speed);

  switch(tier){
    case "slow":
      return { launchMin: 14, launchMax: 18, spinMin: 2400, spinMax: 3200 };
    case "moderate":
      return { launchMin: 13, launchMax: 16, spinMin: 2200, spinMax: 2800 };
    case "fast":
      return { launchMin: 12, launchMax: 15, spinMin: 2000, spinMax: 2600 };
    case "elite":
      return { launchMin: 10.5, launchMax: 14, spinMin: 1800, spinMax: 2400 };
    default:
      return { launchMin: 12, launchMax: 15, spinMin: 2000, spinMax: 2600 };
  }
}
  </script>
</body>
</html>
